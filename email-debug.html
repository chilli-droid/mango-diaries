<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Debug - Mango Diaries</title>
    <link rel="stylesheet" href="frontend-style.css">
    <style>
        .debug-section {
            background: var(--color-main-bg);
            border-radius: var(--border-radius-card);
            padding: 1.5rem;
            margin: 1rem 0;
            border-left: 4px solid var(--color-accent);
        }
        
        .test-result {
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            font-family: monospace;
        }
        
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        
        .test-email {
            background: #e8f4fd;
            border: 2px solid #b8daff;
            border-radius: var(--border-radius-card);
            padding: 1.5rem;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <header class="topbar">
        <h1><img src="assets/logo.PNG" alt="Mango" class="logo">Mango Diaries</h1>
        <a href="index.html">Back to Home</a>
    </header>

    <main class="container">
        <section class="card">
            <h2>üîß Email Delivery Debug Tool</h2>
            
            <div class="debug-section">
                <h3>Problem: Reset emails not arriving</h3>
                <p>Let's figure out why Firebase emails aren't reaching your inbox.</p>
            </div>

            <div class="test-email">
                <h3>üìß Quick Test</h3>
                <form id="testForm">
                    <input type="email" id="testEmail" placeholder="Enter your email to test" required>
                    <button type="submit" class="primary-button">Test Email Delivery</button>
                </form>
                <div id="testResult"></div>
            </div>

            <div class="debug-section">
                <h3>üîç Common Solutions</h3>
                
                <div class="test-result warning">
                    <strong>1. Check Firebase Console</strong><br>
                    Go to Firebase Console ‚Üí Authentication ‚Üí Users<br>
                    Check if your email appears there after sign-up attempts.
                </div>
                
                <div class="test-result warning">
                    <strong>2. Check Spam Folder</strong><br>
                    Firebase emails often go to spam. Check all folders including:
                    <ul>
                        <li>Spam/Junk</li>
                        <li>Promotions</li>
                        <li>Social</li>
                        <li>All Mail</li>
                    </ul>
                </div>
                
                <div class="test-result warning">
                    <strong>3. Try Different Email Providers</strong><br>
                    Some providers block Firebase:
                    <ul>
                        <li>‚úÖ <strong>Gmail</strong> - Works best</li>
                        <li>‚ö†Ô∏è <strong>Outlook/Hotmail</strong> - Often blocks</li>
                        <li>‚ö†Ô∏è <strong>Yahoo</strong> - Check spam</li>
                        <li>‚ùå <strong>ProtonMail/Tutanota</strong> - May block</li>
                    </ul>
                </div>
                
                <div class="test-result warning">
                    <strong>4. Firebase Project Limits</strong><br>
                    New Firebase projects have email sending limits.<br>
                    You might need to upgrade your plan or wait 24 hours.
                </div>
            </div>

            <div class="debug-section">
                <h3>üöÄ Immediate Fixes to Try</h3>
                
                <div class="test-result success">
                    <strong>Fix A: Use Gmail</strong><br>
                    Create a test Gmail account specifically for testing.
                </div>
                
                <div class="test-result success">
                    <strong>Fix B: Check Firebase Usage</strong><br>
                    Go to Firebase Console ‚Üí Usage & Billing<br>
                    Check if you've exceeded email quotas.
                </div>
                
                <div class="test-result success">
                    <strong>Fix C: Domain Verification</strong><br>
                    In Firebase Console ‚Üí Authentication ‚Üí Settings<br>
                    Add your domain to "Authorized domains".
                </div>
                
                <div class="test-result success">
                    <strong>Fix D: Wait and Retry</strong><br>
                    Sometimes Firebase emails are delayed by 5-10 minutes.
                </div>
            </div>

            <div class="debug-section">
                <h3>üìä Firebase Status Check</h3>
                <div id="firebaseStatus">
                    <div class="test-result">Checking Firebase configuration...</div>
                </div>
            </div>
        </section>
    </main>

    <script src="firebase-config.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        const testForm = document.getElementById('testForm');
        const testEmail = document.getElementById('testEmail');
        const testResult = document.getElementById('testResult');
        const firebaseStatus = document.getElementById('firebaseStatus');

        function getFirebaseConfig() {
            if (window.firebaseConfig) return window.firebaseConfig;
            if (window.__firebase_config) {
                try { return JSON.parse(window.__firebase_config); } catch(e) { console.error(e); }
            }
            return {
                apiKey: "AIzaSyB-TDKJTCnIPl4wkQDXZcZvYaadjZuhelk",
                authDomain: "journal-app-bc5ce.firebaseapp.com",
                projectId: "journal-app-bc5ce",
                storageBucket: "journal-app-bc5ce.firebasestorage.app",
                messagingSenderId: "1019175672379",
                appId: "1:1019175672379:web:4062780bcc76e552421a1e",
                measurementId: "G-SFEZDN48R7"
            };
        }

        async function testEmailDelivery(email) {
            try {
                const firebaseConfig = getFirebaseConfig();
                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                
                testResult.innerHTML = '<div class="test-result warning">Sending test email...</div>';
                
                await sendPasswordResetEmail(auth, email);
                
                testResult.innerHTML = `
                    <div class="test-result success">
                        <strong>‚úÖ Email Sent Successfully!</strong><br>
                        Firebase accepted the request. Check these places:
                        <ul>
                            <li>üì® Inbox (wait 5-10 minutes)</li>
                            <li>üóëÔ∏è Spam/Junk folder</li>
                            <li>üìÇ All Mail folder</li>
                            <li>üè∑Ô∏è Promotions tab (Gmail)</li>
                        </ul>
                        <strong>If still not received:</strong>
                        <ul>
                            <li>Try a Gmail address</li>
                            <li>Check Firebase Console for limits</li>
                            <li>Wait 24 hours if you hit daily limits</li>
                        </ul>
                    </div>
                `;
                
            } catch (error) {
                console.error("Test Error:", error);
                testResult.innerHTML = `
                    <div class="test-result error">
                        <strong>‚ùå Error Sending Email</strong><br>
                        Code: ${error.code}<br>
                        Message: ${error.message}<br><br>
                        <strong>Possible Solutions:</strong>
                        <ul>
                            <li>Check Firebase project configuration</li>
                            <li>Verify domain in Authorized domains</li>
                            <li>Check if email/password auth is enabled</li>
                            <li>Try a different email provider</li>
                        </ul>
                    </div>
                `;
            }
        }

        function updateFirebaseStatus() {
            const config = getFirebaseConfig();
            firebaseStatus.innerHTML = `
                <div class="test-result success">
                    <strong>Firebase Configuration:</strong><br>
                    ‚úÖ Project ID: ${config.projectId}<br>
                    ‚úÖ Auth Domain: ${config.authDomain}<br>
                    ‚úÖ API Key: ${config.apiKey ? 'Configured' : 'Missing'}<br><br>
                    <strong>Next Steps:</strong>
                    <ol>
                        <li>Go to <a href="https://console.firebase.google.com/" target="_blank">Firebase Console</a></li>
                        <li>Check Authentication ‚Üí Users for sign-up attempts</li>
                        <li>Check Usage & Billing for email quotas</li>
                        <li>Add your domain to Authorized domains</li>
                    </ol>
                </div>
            `;
        }

        testForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = testEmail.value.trim();
            
            if (!email) {
                testResult.innerHTML = '<div class="test-result error">Please enter an email address</div>';
                return;
            }
            
            await testEmailDelivery(email);
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updateFirebaseStatus();
            testEmail.focus();
        });
    </script>
</body>
</html>